/*!@preserve Copyright 2016 cactus.cloud - Licensed under GNU AGPLv3. See <license.txt> or <http://www.gnu.org/licenses/>.*/
function CactusMasonryPlus(){this.brickH,this.brickW,this.brickMinW,this.brickMinH,this.brickMaxW,this.brickMaxH,this.defaultColor,this.gallery,this.margin,this.tolerance,this.lightbox,this.queue,this.infiniteScroll=!1,this.lazyLoad=!0,this.evalMeta}function CMBrick(){}function CactusMasonryBrick(){this.url="",this.lazyLoad=!1,this.authorUrl="",this.img="",this.w="",this.h="",this.aspect="",this.minW="",this.minH="",this.maxW="",this.maxH="",this.color,this.margin,this.title="",this.author="",this.date="",this.category=""}CactusMasonryPlus.prototype.init=function(i){this.gallery=new CactusGallery,this.gallery.infiniteScroll=this.infiniteScroll,this.gallery.lazyLoad=this.lazyLoad,this.gallery.evalMeta=this.evalMeta;var t=i.children[0],a=t.children[0];this.gallery.init(t,a,2*this.margin,parseFloat(this.tolerance)),a.style.margin=-this.margin+"px",this.queue=new Array},CactusMasonryPlus.prototype.addBrick=function(i){i.margin=this.margin,i.color=this.defaultColor,i.lazyLoad=this.lazyLoad;var t=i.w,a=i.h;"auto"!=this.brickW&&(i.w=this.brickW),"auto"!=this.brickH&&(i.h=this.brickH),"auto"!=this.brickMinW&&(i.minW=this.brickMinW),"auto"!=this.brickMinH&&(i.minH=this.brickMinH),"auto"!=this.brickMaxW&&(i.maxW=this.brickMaxW),"auto"!=this.brickMaxH&&(i.maxH=this.brickMaxH),this.gallery.addBrick(i.build(),t,a)},CMBrick.prototype.init=function(i){this.brick=i,this.img=new Image},CactusMasonryPlus.prototype.queueBrick=function(i){var t=new CMBrick;t.init(i),this.queue.push(t),this.triggerQueue()},CactusMasonryPlus.prototype.triggerQueue=function(){if(this.queue.length>0){var i=this.queue[0];""!=i.brick.img?(i.img.onload=this.loadHandler.bind(this),i.img.src=i.brick.img):this.loadHandler()}},CactusMasonryPlus.prototype.loadHandler=function(){var i=this.queue[0].brick;this.queue.shift(),this.addBrick(i),this.triggerQueue()},CactusMasonryPlus.prototype.destroy=function(){this.queue.length=0,this.gallery.destroy()},CactusMasonryBrick.prototype.build=function(){var i=document.createElement("div");i.className="brick",jQuery(i).css({width:this.w,height:this.h,minWidth:this.minW,minHeight:this.minH,maxWidth:this.maxW,maxHeight:this.maxH});var t=document.createElement("div");t.className="inner";var a={top:this.margin+"px",left:this.margin+"px",right:this.margin+"px",bottom:this.margin+"px"};i.loadPending=!1,""==this.img||null==this.img||"undefined"==typeof this.img?a.backgroundColor=this.generateColor():this.lazyLoad?(i.loadPending=!0,t.dataSource=this.img,i.setAttribute("source",t.dataSource),a.opacity=0):a.backgroundImage="url('"+this.img+"')",""!=this.url&&(t.innerHTML='<a class="postLink" href="'+this.url+'"></a>'),jQuery(t).css(a);var r="";return""!=this.title&&(r+='<div class="title">'+this.title+"</div>"),""!=this.author&&(r+='<div class="author">',r+=""!=this.authorUrl?'<a href="'+this.authorUrl+'">'+this.author+"</a></div>":this.author+"</div>"),""!=this.date&&(r+='<div class="date">'+this.date+"</div>"),""!=this.category&&(r+='<div class="category">'+this.category+"</div>"),""!=r&&(t.innerHTML+='<div class="meta">'+r+"</div>"),i.appendChild(t),i},CactusMasonryBrick.prototype.generateColor=function(){if("pastel"===this.color){var i=Math.floor((255*Math.random()+255)/2),t=Math.floor((255*Math.random()+255)/2),a=Math.floor((255*Math.random()+255)/2);return"rgb("+i+", "+t+", "+a+")"}if("random"===this.color){var i=Math.floor(255*Math.random()),t=Math.floor(255*Math.random()),a=Math.floor(255*Math.random());return"rgb("+i+", "+t+", "+a+")"}return this.color};