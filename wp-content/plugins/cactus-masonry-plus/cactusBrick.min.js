/*!@preserve Copyright 2016 cactus.cloud - Licensed under GNU AGPLv3. See <license.txt> or <http://www.gnu.org/licenses/>.*/
function CactusBrick(){this.DOM,this.meta,this.tolerance=.75,this.id,this.rendered=!1,this.evalMaxW,this.evalMaxH,this.evalMeta,this.x,this.y,this.h,this.w,this.initialW,this.initialH,this.minW,this.minH=0,this.maxH,this.maxResH,this.maxResW,this.metaH,this.aspect=1,this.cssW,this.cssH,this.cssMinW,this.cssMinH,this.cssMaxW,this.cssMaxH,this.hasH,this.hasMinW,this.hasMinH,this.hasMaxW,this.hasMaxH,this.scalable,this.scalableMinW,this.scalableMaxW,this.cssValH,this.cssValMinW,this.cssValMinH,this.cssValMaxW,this.cssValMaxH}CactusBrick.prototype.init=function(s,i,t,h,a,e,n){this.id=i,this.DOM=s,this.meta=jQuery(s).find(".meta")[0],this.evalMeta=h,this.tolerance=t;var c=e/n;isNaN(c)||(this.aspect=c),this.maxResH=e,this.maxResW=n,this.initialW=Math.floor(jQuery(s).outerWidth()),this.initialH=Math.floor(jQuery(s).outerHeight()),this.getCSS(),this.updateSizing(a)},CactusBrick.prototype.clone=function(s){this.DOM=s.DOM,this.tolerance=s.tolerance,this.id=s.id,this.rendered=s.rendered,this.evalMaxW=s.evalMaxW,this.evalMaxH=s.evalMaxH,this.evalMeta=s.evalMeta,this.x=s.x,this.y=s.y,this.h=s.h,this.w=s.w,this.initialW=s.initialW,this.initialH=s.initialH,this.maxResH=s.maxResH,this.maxResW=s.maxResW,this.minW=s.minW,this.minH=s.minH,this.maxH=s.maxH,this.metaH=s.metaH,this.aspect=s.aspect,this.cssW=s.cssW,this.cssH=s.cssH,this.cssMinW=s.cssMinW,this.cssMinH=s.cssMinH,this.cssMaxW=s.cssMaxW,this.cssMaxH=s.cssMaxH,this.hasH=s.hasH,this.hasMinW=s.hasMinW,this.hasMinH=s.hasMinH,this.hasMaxW=s.hasMaxW,this.hasMaxH=s.hasMaxH,this.scalable=s.scalable,this.scalableMinW=s.scalableMinW,this.scalableMaxW=s.scalableMaxW,this.cssValH=s.cssValH,this.cssValMinW=s.cssValMinW,this.cssValMinH=s.cssValMinH,this.cssValMaxW=s.cssValMaxW,this.cssValMaxH=s.cssValMaxH},CactusBrick.prototype.getCSS=function(){this.cssW=this.DOM.style.width,this.cssH=this.DOM.style.height,this.cssMinW=this.DOM.style.minWidth,this.cssMinH=this.DOM.style.minHeight,this.cssMaxW=this.DOM.style.maxWidth,this.cssMaxH=this.DOM.style.maxHeight,this.scalable=-1===this.cssW.indexOf("%"),this.hasH="0px"!=this.cssH&&-1!==this.cssH.indexOf("px"),this.hasMinW=""!=this.cssMinW,this.hasMinH="0px"!=this.cssMinH&&-1!==this.cssMinH.indexOf("px"),this.hasMaxW=""!=this.cssMaxW,this.hasMaxH="0px"!=this.cssMaxH&&-1!==this.cssMaxH.indexOf("px"),this.scalableMinW=this.hasMinW&&-1!==this.cssMinW.indexOf("%"),this.scalableMaxW=this.hasMaxW&&-1!==this.cssMaxW.indexOf("%")},CactusBrick.prototype.updateSizing=function(s){function i(s){var i=parseFloat(s);return jQuery.isNumeric(i)?i:0}this.rendered=!1,this.cssValMinW=this.scalableMinW?s/100*i(this.cssMinW):this.hasMinW?Math.min(i(this.cssMinW),s):0,this.hasH&&(this.cssValH=i(this.cssH)),this.cssValMinH=this.hasMinH?i(this.cssMinH):0,this.cssValMaxW=this.scalableMaxW?s/100*i(this.cssMaxW):this.hasMaxW?i(this.cssMaxW):0,this.cssValMaxH=this.hasMaxH?i(this.cssMaxH):0,this.scalable?(this.w=this.initialW,this.maxW=this.hasMaxW?this.cssValMaxW:0==this.maxResW?this.initialW:this.maxResW,this.minW=this.hasMinW?Math.max(this.w*this.tolerance,this.cssValMinW):this.w*this.tolerance,this.w>this.maxW&&(this.w=this.maxW),this.w<this.minW&&(this.w=this.minW),this.maxH=this.hasH&&this.hasMaxH?Math.min(this.cssValH,this.cssValMaxH,this.maxW*this.aspect):this.hasMaxH?Math.min(this.initialH,this.cssValMaxH,this.maxW*this.aspect):this.hasH?this.cssValH:this.maxW*this.aspect,this.minH=this.hasMinH?Math.max(this.minW*this.aspect*this.tolerance,this.cssValMinH):this.minW*this.tolerance,this.minH>this.maxH&&(this.maxH=this.minH),this.evalMaxW=this.w,this.evalMaxH=this.initialH,this.h=this.w*this.aspect,this.h>this.maxH&&(this.h=this.maxH),this.h<this.minH&&(this.h=this.minH)):(this.w=s*i(this.cssW)/100,this.maxW=this.hasMaxW?this.cssValMaxW:this.w,this.minW=this.hasMinW?this.cssValMinW:this.w,this.w>this.maxW&&(this.w=this.maxW),this.w<this.minW&&(this.w=this.minW),this.maxH=this.hasH&&this.hasMaxH?Math.min(this.cssValH,this.cssValMaxH):this.hasMaxH?Math.min(this.maxResH,this.cssValMaxH):this.hasH?this.cssValH:this.maxResH,this.minH=this.hasMinH?Math.min(this.initialH,this.cssValMinH):this.w*this.aspect,this.minH>this.maxH&&(this.maxH=this.minH),this.h=this.w*this.aspect,this.h>this.maxH&&(this.h=this.maxH),this.h<this.minH&&(this.h=this.minH)),this.metaH=this.evalMeta?jQuery(this.meta).outerHeight():0,this.h=Math.ceil(this.h),this.w=Math.floor(this.w),this.maxW=Math.floor(this.maxW),this.minW=Math.floor(this.minW),this.maxH=Math.ceil(this.maxH),this.minH=Math.ceil(this.minH),this.DOM.setAttribute("maxH",this.maxH),this.DOM.setAttribute("minH",this.minH),this.DOM.setAttribute("maxW",this.maxW),this.DOM.setAttribute("minW",this.minW),this.DOM.setAttribute("w",this.w),this.DOM.setAttribute("h",this.h),this.DOM.setAttribute("aspect",this.aspect),this.DOM.setAttribute("initH",this.initialH),this.DOM.setAttribute("initW",this.initialW),this.DOM.setAttribute("metaH",this.metaH)},CactusBrick.prototype.updateWidth=function(s){this.updateSizing(s)},CactusBrick.prototype.intersects=function(s){return s.scalable?this.scalableIntersect(s):this.nonScalableIntersect(s)},CactusBrick.prototype.scalableIntersect=function(s){var i=this.y,t=s.y,h=this.x,a=s.x,e=h+this.w,n=a+Math.max(s.initialW,s.minW),c=i+this.h+this.metaH,x=t+s.maxH+s.metaH;if(h>=n)return!1;if(h>=a+s.minW&&h>a&&(t>i&&c>t||x>i&&c>x))return s.w=Math.min(Math.max(h-a,s.minW),s.evalMaxW),s.evalMaxW=s.w,!1;if(a>=e)return!1;if(i>=x)return!1;if(i>=t+s.minH&&i>t&&(a>h&&e>a||n>h&&e>n))return s.h=Math.min(Math.max(i-t,s.minH),s.evalMaxH,s.h),s.evalMaxH=s.h,!1;if(t>=c)return!1;var M=Math.max(s.initialW,s.minW);return s.w=M,s.evalMaxW=M,M=Math.ceil(s.w*s.aspect),M>s.maxH&&(M=s.maxH),M<s.minH&&(M=s.minH),s.h=M,s.evalMaxH=M,s.x=e,!0},CactusBrick.prototype.nonScalableIntersect=function(s){var i=this.y,t=s.y,h=this.x,a=s.x,e=h+this.w,n=a+s.w,c=i+this.h+this.metaH,x=t+s.h+s.metaH;return h>=n||a>=e?!1:i>=x||t>=c?!1:(s.x=e,!0)},CactusBrick.prototype.update=function(){jQuery(this.DOM).css(this.scalable?{top:this.y+"px",left:this.x+"px",height:this.h+"px",width:this.w+"px",minWidth:this.minW+"px",maxWidth:this.maxW+"px",minHeight:this.minH+"px",maxHeight:this.maxH+"px",visibility:"visible"}:{top:this.y+"px",left:this.x+"px",height:this.h+"px",width:this.w+"px",minWidth:this.minW+"px",maxWidth:this.maxW+"px",minHeight:this.minH+"px",maxHeight:this.maxH+"px",visibility:"visible"}),this.rendered=!0},CactusBrick.prototype.removeFromFlow=function(){this.rendered=!1};